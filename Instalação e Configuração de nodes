Instalando e configurando um cluster Kubernetes no CentOS 7

**Configurações iniciais

Estas configurações deverão ser realizadas em todas os hosts que comporão o cluster, ou seja, tanto o nó master como os escravos.

--Para iniciar, tome nota do hostname de cada máquina do cluster. Caso não saiba os nomes das máquinas você pode utilizar o seguinte comando para descobrir:

      $ hostname
  
--Essas informações serão importante em toda configuração. No meu caso, tenho os seguintes hostnames:

      Master: kubernetes-master
      Node1: kubernetes-node-1
      Node2: kubernetes-node-2

    
--Em cada um dos nós, edite o arquivo /etc/hosts e configure os ips de cada uns dos hosts.

      $ sudo vi /etc/hosts
      
      
--Desabilite o SELinux do CentOS.

      $ sudo setenforce 0
      $ sudo sed -i --follow-symlinks 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux
      
--Execute o comando a seguir para corrigir possíveis falhas de roteamento.

      $ sudo bash -c 'cat <<EOF > /etc/sysctl.conf
      net.bridge.bridge-nf-call-ip6tables = 1
      net.bridge.bridge-nf-call-iptables = 1
      EOF'
  
  
--Execute o comando abaixo para aplicar as configurações.

      $ sudo sysctl --system

--Desabilite o SWAP comentando (coloque # no início) a linha que começa com /dev/mapper/centos-swap do arquivo /etc/fstab.

      $ sudo vi /etc/fstab
      
      
--Adicione o repositório do Kubernetes no gerenciador de pacotes Yum.

      $ sudo bash -c 'cat <<EOF > /etc/yum.repos.d/kubernetes.repo
      [kubernetes]
      name=Kubernetes
      baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
      enabled=1
      gpgcheck=1
      repo_gpgcheck=1
      gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
      EOF'
    
    
 --Reinicie os hosts para aplicar as alterações, executando o seguinte comando:

     $ sudo init 6
     
 Instalando o Docker

O Docker é um pré-requisito para a instalação e funcionamento do Kubernetes. Sendo assim, instale o Docker em cada um dos hosts.

--Para iniciar a instalação do Docker, primeiramente instale o pacote yum-utils executando o seguinte comando:

      $ sudo yum install -y yum-utils \
        device-mapper-persistent-data \
        lvm2

      $ yum install pigz

--Em seguida, adicione o repositório do Docker-CE de versões estáveis.

      $ sudo yum-config-manager \
          --add-repo \
          https://download.docker.com/linux/centos/docker-ce.repo
          
--Execute o seguinte comando para instalar o docker:

      $ sudo yum install -y docker-ce

--Habilite e inicie o Docker.

      $ sudo systemctl enable docker && sudo systemctl start docker
      
--Adicione o seu usuário no grupo do Docker para garantir que possa usar os comandos Docker sem necessidade de sudo:

      $ sudo groupadd docker
      $ sudo usermod -aG docker kleber
      **Adicione o usuário que desejar, no meu caso é kleber.
      
Para que as configurações possam ter efeito, é necessário reiniciar a sessão.

--Após logar novamente, cheque a versão a instalada com o seguinte comando:

      $ docker --version

No meu caso, a versão instalada foi a Docker version 18.09.6, build 481bc77156



      
